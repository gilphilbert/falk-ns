(function(t){function e(e){for(var i,o,n=e[0],l=e[1],u=e[2],h=0,d=[];h<n.length;h++)o=n[h],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);c&&c(e);while(d.length)d.shift()();return r.push.apply(r,u||[]),s()}function s(){for(var t,e=0;e<r.length;e++){for(var s=r[e],i=!0,n=1;n<s.length;n++){var l=s[n];0!==a[l]&&(i=!1)}i&&(r.splice(e--,1),t=o(o.s=s[0]))}return t}var i={},a={app:0},r=[];function o(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=i,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(s,i,function(e){return t[e]}.bind(null,i));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],l=n.push.bind(n);n.push=e,n=n.slice();for(var u=0;u<n.length;u++)e(n[u]);var c=l;r.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"56d7":function(t,e,s){"use strict";s.r(e);var i=s("2b0e"),a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[t.loginScreen?s("Login",{attrs:{isLoggedInParent:t.isLoggedIn}}):t._e(),t.loginScreen?t._e():s("Main",{attrs:{isLoggedInParent:t.isLoggedIn}})],1)},r=[],o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container",staticStyle:{height:"100vh"}},[s("div",{staticClass:"row",staticStyle:{height:"100%","align-items":"center"}},[s("div",{staticClass:"col-xs-6 col-xs-offset-3 has-text-centered"},[s("img",{attrs:{src:"/img/falk-blue-white.svg"}}),s("h1",[t._v("Soundbyte")]),s("p",{staticClass:"subtitle is-4"},[t._v("Please login to access your music!")]),s("br"),s("fieldset",{staticStyle:{margin:"0 auto","max-width":"300px"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.user,expression:"user"}],staticClass:"input",attrs:{type:"text",placeholder:"Username",autofocus:"true"},domProps:{value:t.user},on:{input:function(e){e.target.composing||(t.user=e.target.value)}}})]),s("br"),s("fieldset",{staticStyle:{margin:"0 auto","max-width":"300px"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.pass,expression:"pass"}],staticClass:"input",attrs:{type:"password",placeholder:"Password"},domProps:{value:t.pass},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.login(e)},input:function(e){e.target.composing||(t.pass=e.target.value)}}})]),""!==t.error?s("span",{staticClass:"message-danger"},[t._v(t._s(t.error))]):t._e(),s("br"),s("button",{staticClass:"button is-rounded is-primary",on:{click:t.login}},[t._v("Log In")])])])])},n=[],l={name:"Login",props:["isLoggedInParent"],data(){return{user:"",pass:"",error:""}},methods:{login(){const t=JSON.stringify({username:this.user,password:this.pass});window.fetch("/api/login",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:t}).then(t=>t.json()).then(t=>{"failed"===t.state||!1===t.state?this.error="Invalid username and/or password":this.isLoggedInParent()}).catch(t=>{console.log(t)})}}},u=l,c=s("2877"),h=Object(c["a"])(u,o,n,!1,null,"87282724",null),d=h.exports,p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{attrs:{id:"content-container"}}),s("Menu",{attrs:{isActive:t.showMenu}}),s("ControlBar",{attrs:{isActive:t.showControls,player:t._player,playback:t.playback,toggleQueue:t.toggleQueue}}),s("Queue",{attrs:{isActive:t.showQueue,playback:t.playback,toggleQueue:t.toggleQueue}})],1)},f=[],g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("aside",{staticClass:"menu",class:{"is-active":t.isActive}},[s("figure",{staticClass:"image menu-brand"},[s("a",{attrs:{"data-navigo":"",href:"/"}},[s("svg",{staticStyle:{isolation:"isolate"},attrs:{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 39.961 39.961",width:"40px",height:"40px"}},[s("circle",{attrs:{"vector-effect":"non-scaling-stroke",cx:"19.9805",cy:"19.9805",r:"15.5",fill:"rgb(255,255,255)"}}),s("path",{attrs:{d:" M 0 19.981 C 0 8.953 8.953 0 19.981 0 C 31.008 0 39.961 8.953 39.961 19.981 C 39.961 31.008 31.008 39.961 19.981 39.961 C 8.953 39.961 0 31.008 0 19.981 Z  M 15.089 28.897 L 15.089 28.897 L 10.274 28.897 L 10.274 28.897 Q 10.045 28.897 9.879 28.732 L 9.879 28.732 L 9.879 28.732 Q 9.714 28.566 9.714 28.413 L 9.714 28.413 L 9.714 28.413 Q 9.714 28.26 9.739 28.184 L 9.739 28.184 L 15.293 11.905 L 15.293 11.905 Q 15.522 11.064 16.439 11.064 L 16.439 11.064 L 23.522 11.064 L 23.522 11.064 Q 24.439 11.064 24.668 11.905 L 24.668 11.905 L 30.222 28.184 L 30.222 28.184 Q 30.248 28.26 30.248 28.413 L 30.248 28.413 L 30.248 28.413 Q 30.248 28.566 30.082 28.732 L 30.082 28.732 L 30.082 28.732 Q 29.916 28.897 29.687 28.897 L 29.687 28.897 L 24.872 28.897 L 24.872 28.897 Q 24.057 28.897 23.726 28.031 L 23.726 28.031 Q 20.444 17.551 19.981 15.981 Q 19.516 17.591 16.236 28.031 L 16.236 28.031 Q 15.904 28.897 15.089 28.897 L 15.089 28.897 L 15.089 28.897 Z ","fill-rule":"evenodd",fill:"rgb(77,132,195)"}})])])]),s("ul",{staticClass:"menu-list has-text-centered"},[s("li",[s("a",{attrs:{href:"/","data-navigo":""}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#play"}})]),s("div",{staticClass:"detail"},[t._v("Playing")])])]),s("li",[s("a",{attrs:{href:"/playlists","data-navigo":""}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#list"}})]),s("div",{staticClass:"detail"},[t._v("Playlists")])])]),s("li",[s("a",{attrs:{href:"/artists","data-navigo":""}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#mic"}})]),s("div",{staticClass:"detail"},[t._v("Artists")])])]),s("li",[s("a",{attrs:{href:"/albums","data-navigo":""}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#disc"}})]),s("div",{staticClass:"detail"},[t._v("Albums")])])]),s("li",[s("a",{attrs:{href:"/genres","data-navigo":""}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#music"}})]),s("div",{staticClass:"detail"},[t._v("Genres")])])]),s("li",[s("a",{attrs:{href:"/settings","data-navigo":""}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#settings"}})]),s("div",{staticClass:"detail"},[t._v("Settings")])])]),s("li",[s("a",{attrs:{href:"/logout","data-navigo":""}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#log-out"}})]),s("div",{staticClass:"detail"},[t._v("Log Out")])])])])])},m=[],v={name:"Menu",props:["isActive"]},b=v,y=Object(c["a"])(b,g,m,!1,null,"6f6d68e2",null),w=y.exports,C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"is-active",attrs:{id:"control-bar","data-bind":"swipeup: showQueue"}},[s("div",{staticClass:"progress-topper",style:{width:t.playback.elapsed/t.playback.queue[t.playback.queuePos].duration*t.$innerWidth+"px"}}),s("div",{staticClass:"row is-marginless"},[s("div",{staticClass:"col-xs col-md"},[s("div",{staticClass:"row now-playing"},[s("div",{staticClass:"col-xs is-narrow"},[s("figure",{staticClass:"image is-70x70"},[s("img",{attrs:{src:t.playback.queue[t.playback.queuePos].cover}})])]),s("div",{staticClass:"col-xs"},[s("p",{staticClass:"is-5"},[t._v(t._s(t.playback.queue[t.playback.queuePos].title))]),s("p",{staticClass:"subtitle is-5"},[t._v(t._s(t.playback.queue[t.playback.queuePos].artist))])])])]),s("div",{staticClass:"col-xs no-grow col-md playing-controls misc-controls"},[s("svg",{staticClass:"random feather hidden--to-desktop",on:{click:t.player.random}},[s("use",{attrs:{href:"/img/feather-sprite.svg#shuffle"}})]),s("svg",{staticClass:"feather prev",on:{click:t.player.prev}},[s("use",{attrs:{href:"/img/feather-sprite.svg#skip-back"}})]),s("span",{staticClass:"play-button pointer",on:{click:t.player.toggle}},[s("svg",{staticClass:"feather",class:{"is-hidden":t.playback.isPlaying}},[s("use",{attrs:{href:"/img/feather-sprite.svg#play"}})]),s("svg",{staticClass:"feather",class:{"is-hidden":!t.playback.isPlaying}},[s("use",{attrs:{href:"/img/feather-sprite.svg#pause"}})])]),s("svg",{staticClass:"feather next",on:{click:t.player.skip}},[s("use",{attrs:{href:"/img/feather-sprite.svg#skip-forward"}})]),s("svg",{staticClass:"repeat feather hidden--to-desktop",on:{click:t.player.repeat}},[s("use",{attrs:{href:"/img/feather-sprite.svg#repeat"}})])]),s("div",{staticClass:"col-md has-text-right hidden--to-desktop"},[s("div",{staticClass:"row end-md"},[s("div",{staticClass:"col-md no-grow play-progress"},[s("span",[t._v(t._s(Math.floor(t.playback.elapsed/60)+":"+("0"+t.playback.elapsed%60).slice(-2,3)))]),t._v("/"),s("span",[t._v(t._s(Math.floor(t.playback.queue[t.playback.queuePos].duration/60)+":"+("0"+t.playback.queue[t.playback.queuePos].duration%60).slice(-2,3)))])]),s("div",{staticClass:"col-md no-grow"},[s("svg",{staticClass:"queue feather hidden--to-desktop",on:{click:t.toggleQueue}},[s("use",{attrs:{href:"/img/feather-sprite.svg#queue-alt"}})])])])])])])},k=[],A={name:"ControlBar",props:["isActive","player","playback","toggleQueue"]},q=A,P=Object(c["a"])(q,C,k,!1,null,"510d5381",null),L=P.exports,_=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:{"is-active":t.isActive},attrs:{id:"queue-list"}},[s("div",{attrs:{id:"queue-header"},on:{click:t.toggleQueue}},[s("h1",[t._v("Play Queue")])]),s("div",{attrs:{id:"queue-items"}},[s("table",t._l(t.playback.queue,(function(e,i){return s("tr",{class:{"is-playing":i===t.playback.queuePos}},[s("td",{on:{click:function(e){return t.player.changePos(i)}}},[s("figure",{staticClass:"image is-40x40"},[s("img",{attrs:{src:e.cover,load:"lazy"}})])]),s("td",{on:{click:function(e){return t.player.changePos(i)}}},[s("p",{staticClass:"is-5"},[t._v(t._s(e.title))]),s("p",{staticClass:"subtitle is-5"},[t._v(t._s(e.artist+" - "+Math.floor(e.duration/60)+":"+("0"+e.duration%60).slice(-2,3)))])]),s("td",{attrs:{"data-bind":"click: $parent.queue.remove"}},[s("span",{staticClass:"delete"},[s("svg",{staticClass:"feather delete"},[s("use",{attrs:{"xlink:href":"/img/feather-sprite.svg#x-circle"}})])])])])})),0)])])},x=[],I={name:"Queue",props:["isActive","toggleQueue","playback"]},Q=I,M=Object(c["a"])(Q,_,x,!1,null,"9a581dec",null),T=M.exports;const E=new(window.AudioContext||window.webkitAudioContext),S=0,j=1,O=0,W=1,$=2;class N{constructor(t=100){this.sources=[],this.html5Init(),this.reset(),this.gainNode=E.createGain(),this.gainNode.connect(E.destination),this.progressTick=t,this._handlers(),this.cacheWorker=new Worker("/js/player-worker.js");const e=t=>{const e=t.data;if(console.log("[MAIN]",e),e.cached)for(let s=this.queuePos;s<this.queue.length;s++){let t=this.queue[s];t.id===e.id&&(t.cached=!0,s===this.queuePos?this.switchToWebAudio():s===this.queuePos+1&&this.prepareWebAudio())}};this.cacheWorker.addEventListener("message",e)}on(t,e){this.eventCallbacks=this.eventCallbacks||{},this.eventCallbacks[t]=this.eventCallbacks[t]||[],this.eventCallbacks[t].push(e)}dispatchEvent(t,e){this.eventCallbacks=this.eventCallbacks||{},t in this.eventCallbacks&&this.eventCallbacks[t].length>0&&this.eventCallbacks[t].forEach(t=>t(e))}currentState(){const t=["stop","play","pause"];return t[this.state]}isPaused(){return this.state===$}isPlay(){return this.state===W}currentPos(){return this.parent.queuePos}currentTrackID(){const t=this.parent;return t.queue.length>0?t.queue[t.queuePos].id:null}html5Init(){this.html5Audio=new window.Audio,this.html5Audio.controls=!1,this.html5Audio.addEventListener("canplaythrough",()=>{this.html5Audio.play(),this.cacheQueue()}),this.html5Audio.addEventListener("play",()=>{this.dispatchEvent("play",new window.Event("play")),this.startTime=E.currentTime,this.timeLeft=this.html5Audio.duration});const t=E.createMediaElementSource(this.html5Audio);t.connect(E.destination)}webAudioInit(t){this.sources[t]=E.createBufferSource(),this.sources[t].connect(this.gainNode),this.sources[t].addEventListener("ended",t=>{this.state===W&&(this.sources.length?(this.startTime=E.currentTime,this.timeLeft=this.sources[0].buffer.duration):(this.startTime=-1,this.timeLeft=-1),this.queuePos++,t.target.disconnect(0),t.target.buffer&&(t.target.buffer=null),this.sources.shift(),this.queue[this.queuePos+1]?(this.dispatchEvent("next",new window.Event("next")),this.prepareWebAudio(),this.cacheQueue()):(this.queuePos=0,this.dispatchEvent("stop",new window.Event("stop"))))})}stopAllWebAudio(){for(let t=this.sources.length-1;t>=0;t--)this.sources[t].disconnect(0),this.sources.pop()}loadTrack(t){return new Promise((e,s)=>{const i=window.indexedDB.open("falk",2).onsuccess=i=>{const a=i.target.result.transaction("cache","readonly"),r=a.objectStore("cache"),o=this.queue[t];r.get(o.id).onsuccess=t=>{t.target.result?t.target.result.data.arrayBuffer().then(t=>{console.log("[MAIN] Loaded track ",o.id),E.decodeAudioData(t,(function(t){e(t)}))}).catch(t=>s(new Error("Cache invalid"))):(s(new Error("Not in cache")),console.log(o))},a.onerror=t=>s(t)};i.onerror=t=>s(t)})}isCached(t){return new Promise((e,s)=>{const i=window.indexedDB.open("falk",2).onsuccess=i=>{const a=i.target.result.transaction("cache","readonly"),r=a.objectStore("cache");r.get(t).onsuccess=t=>{t.target.result?e(!0):e(!1)},a.onerror=t=>s(t)};i.onerror=t=>s(t)})}switchToWebAudio(){this.loadTrack(this.queuePos,!0).then(t=>{this.webAudioInit(0),this.sources[0].buffer=t,console.log("Switching to Web Audio API");const e=this.html5Audio.currentTime;this.playMode=j,this.state===W&&(this.html5Audio.pause(),this.html5Audio.src="",this.sources[0].start(0,e))})}prepareWebAudio(){this.loadTrack(this.queuePos+1,!0).then(t=>{this.webAudioInit(1),this.sources[1].buffer=t;const e=this.startTime+this.timeLeft;this.sources[1].start(e),console.log("[MAIN] Next song scheduled")})}_handlers(){window.onbeforeunload=()=>(this.stopAllWebAudio(),null),this.progress=()=>{if(this.state===W){window.setTimeout(this.progress,this.progressTick);const t=this.html5Audio.duration||(this.sources[0]?this.sources[0].buffer.duration:null)||!1;!1!==t&&this.dispatchEvent("progress",new window.CustomEvent("progress",{detail:{elapsed:t-(this.timeLeft-(E.currentTime-this.startTime)),duration:t}}))}}}play(t=-1){if(E.resume(),this.state===$&&this.playMode===S)return void this.html5Audio.play();if(t<0&&(t=this.queuePos),this.queue.length<0||t>=this.queue.length)throw new Error("Invalid queue position");this.state===W&&(this.playMode===S?(this.html5Audio.pause(),this.html5Audio.src="",this.timeLeft=0,this.startTime=0):(this.state=O,this.stopAllWebAudio()));const e=this.queue[t];e.cached?this.loadTrack(t,!0).then(e=>{this.webAudioInit(0),this.sources[0].buffer=e;const s=this.state===$?this.sources[0].buffer.duration-this.timeLeft:0;this.sources[0].start(0,s),this.startTime=E.currentTime,this.state!==$&&(this.timeLeft=this.sources[0].buffer.duration),this.dispatchEvent("play",new window.Event("play")),this.playMode=j,this.queue[t+1]&&this.queue[t+1].cached&&this.prepareWebAudio()}):(this.html5Audio.src=e.url,this.playMode=S),this.state=W,this.progress()}pause(){this.state===W&&(this.state=$,this.dispatchEvent("pause",new window.Event("pause")),this.playMode===S?(this.timeLeft=this.timeLeft-(E.currentTime-this.startTime),this.html5Audio.pause()):this.playMode===j&&(this.timeLeft=this.timeLeft-(E.currentTime-this.startTime),this.stopAllWebAudio()))}toggle(){this.state===W?this.pause():this.play()}stop(){this.playMode===S?(this.html5Audio.pause(),this.html5Audio.src=""):this.stopAllWebAudio(),this.state=O,this.dispatchEvent("stop",new window.Event("stop")),this.timeLeft=0,this.startTime=0,this.queuePos=0}skip(){this.changePos(this.queuePos+1)}prev(){this.changePos(this.queuePos-1)}random(){}repeat(){}async enqueueOne({id:t,url:e}){if(t=parseInt(t)||!1,e=e||!1,!1!==t&&!1!==e){let i=!1;try{i=await this.isCached(t)}catch(s){console.log(s)}const a={id:t,url:e,data:null,cached:i};this.queue.push(a)}}async enqueue(t){if(Array.isArray(t))for(let e=0;e<t.length;e++)await this.enqueueOne(t[e])}async setTracks(t,e=0,s=!1){this.reset(),this.cacheWorker.postMessage({clear:!0}),this.queuePos=e,await this.enqueue(t),s&&this.play()}changePos(t){this.stop(),this.queue[t]&&(this.queuePos=t),this.play()}populateQueue(){if(this.queue.length>0)for(let t=this.queuePos;t<this.queue.length&&t<=this.queuePos+3;t++)console.log(this.queue[t])}clearQueue(){this.reset()}cacheQueue(){const t=this.queue.slice(this.queuePos).filter(t=>!1===t.cached).slice(0,5);this.cacheWorker.postMessage({items:t})}reset(){this.state=O,this.playMode=!1,this.stopAllWebAudio(),this.html5Audio.src="",this.startTime=-1,this.timeLeft=-1,this.queue=[],this.queuePos=0}}class U{constructor(t){this.db=new loki("falkns0113.db",{autoload:!0,autoloadCallback:()=>{this.music=this.db.getCollection("songs"),this.music||(this.music=this.db.addCollection("songs",{unique:["id"]})),this.music.count()>0&&"function"===typeof t?(t(),this.update()):this.update(t)},autosave:!0,autosaveInterval:4e3})}async update(t){t=t||null;try{this.music.chain().find().update(t=>{t.present=!1});let t=await window.fetch("/api/songs/all"),e=await t.json();const s=e.data.length;let i=s;do{e.data.forEach(t=>{this.addSong(t)}),t=await window.fetch("/api/songs/all/"+i+"/"+s),e=await t.json(),i+=e.data.length}while(e.data.length>0);this.music.chain().find({present:!1}).remove()}catch(e){console.log("Could not connect to API to update library",e)}null!==t&&t()}addSong(t){try{const e=this.music.findOne({_id:t.$loki})||null;if(null===e){const e=this.music.insert({_id:t.$loki,info:t.info,favorite:t.favorite,playCount:t.playCount,cached:!1,present:!0});e.meta=t.meta,this.music.update(e)}else JSON.stringify(e.info)!==JSON.stringify(t.info)&&(e.info=t.info),e.present=!0,this.music.update(e)}catch(e){console.error("Could not add song to database",e)}}async getStats(){const t={songs:0,albums:0,artists:0},e=this.music.find();return t.songs=e.length,t.artists=[...new Set(e.map(t=>t.info.albumartist))].length,t.albums=[...new Set(e.map(t=>t.info.album))].length,t}async getArtists(){const t=this.music.chain().find().compoundsort([["info.artist.art",!0],"info.albumartist"]).data();return t.filter((t,e,s)=>s.findIndex(e=>e.info.albumartist===t.info.albumartist)===e).map(t=>({title:t.info.albumartist,art:"/art/"+(""!==t.info.art.artist?t.info.art.artist:"placeholder.png"),url:"/artist/"+encodeURIComponent(t.info.albumartist),subtitle:"",surl:""}))}async getArtist(t){const e=this.music.chain().find({"info.albumartist":t}).compoundsort([["info.artist.art",!0],"info.albumartist"]).limit(1).data()[0].info.art.artist,s=this.music.chain().find({"info.albumartist":t}).simplesort("info.year").data(),i=s.map(t=>({art:"/art/"+(""!==t.info.art.cover?t.info.art.cover:"placeholder.png"),artistart:"/art/"+(""!==e?e:"placeholder.png"),title:t.info.album,url:`/album/${encodeURIComponent(t.info.albumartist)}/${encodeURIComponent(t.info.album)}`,subtitle:t.info.year,surl:""})).filter((t,e,s)=>s.findIndex(e=>e.title===t.title&&e.subtitle===t.subtitle)===e);return{albums:i}}async getAlbums(){const t=this.music.chain().find().simplesort("info.album").data(),e=t.map(t=>({art:"/art/"+(""!==t.info.art.cover?t.info.art.cover:"placeholder.png"),title:t.info.album,url:`/album/${encodeURIComponent(t.info.albumartist)}/${encodeURIComponent(t.info.album)}`,subtitle:t.info.albumartist,surl:"/artist/"+encodeURIComponent(t.info.albumartist)})).filter((t,e,s)=>s.findIndex(e=>e.title===t.title&&e.subtitle===t.subtitle)===e);return e}async getAlbum(t,e){const s=this.music.chain().find({"info.albumartist":t,"info.album":e}).compoundsort(["info.disc","info.track"]).data(),i=s.map(t=>(t.info._id=t._id,t.info.shortformat=t.info.format.samplerate/1e3+"kHz "+(t.info.format.bits?t.info.format.bits+"bit":""),t.info.artist=t.info.artists.length>0?t.info.artists[0]:t.info.albumartist,t.info.art.cover=""!==t.info.art.cover?t.info.art.cover:"placeholder.png",t.info));return{title:i[0].album,art:"/art/"+i[0].art.cover,artist:i[0].albumartist,year:i[0].year,genre:i[0].genre,shortformat:i[0].shortformat,tracks:i}}async getGenres(){const t=this.music.chain().find().simplesort("info.genre").data(),e=t.map(t=>({art:"/art/"+(t.info.art.cover?t.info.art.cover:"placeholder.png"),title:t.info.genre,url:"/genre/"+encodeURIComponent(t.info.genre),subtitle:"",surl:""})).filter((t,e,s)=>s.findIndex(e=>e.title===t.title&&""!==e.title)===e);return e}async getGenre(t){const e=this.music.chain().find({"info.genre":t}).simplesort("info.album").data(),s=e.map(t=>({art:"/art/"+(t.info.art.cover?t.info.art.cover:"placeholder.png"),title:t.info.album,url:`/album/${encodeURIComponent(t.info.albumartist)}/${encodeURIComponent(t.info.album)}`,subtitle:t.info.albumartist,surl:"/artist/"+encodeURIComponent(t.info.albumartist)})).filter((t,e,s)=>s.findIndex(e=>e.title===t.title&&e.subtitle===t.subtitle)===e);return s}}var R={name:"Main",components:{Menu:w,ControlBar:L,Queue:T},created(){this._player=new N,this._database=new U(()=>{this._database.getStats().then(t=>console.log(t))})},data(){return{showMenu:!1,showControls:!1,showQueue:!0,playback:{isPlaying:!1,queuePos:1,elapsed:"53",queue:[{title:"The Only Night",artist:"James Morrison",duration:"217",cover:"/art/4be59c8690054a786e401f40177c41a76b8caee0-cover.jpg"},{title:"Precious Love",artist:"James Morrison",duration:"218",cover:"/art/4be59c8690054a786e401f40177c41a76b8caee0-cover.jpg"}]}}},props:["isLoggedInParent"],methods:{toggleQueue(){this.showQueue=!this.showQueue}}},B=R,J=Object(c["a"])(B,p,f,!1,null,null,null),D=J.exports,G={name:"App",components:{Login:d,Main:D},data(){return{loginScreen:!0}},methods:{isLoggedIn(t=!0){this.loginScreen=!t}}},z=G,Z=Object(c["a"])(z,a,r,!1,null,null,null),H=Z.exports;i["a"].prototype.$innerWidth=window.innerWidth,new i["a"]({render:t=>t(H)}).$mount("#app")}});
//# sourceMappingURL=app.c5f8b281.js.map