(function(t){function e(e){for(var a,n,o=e[0],l=e[1],c=e[2],d=0,p=[];d<o.length;d++)n=o[d],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&p.push(i[n][0]),i[n]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);u&&u(e);while(p.length)p.shift()();return r.push.apply(r,c||[]),s()}function s(){for(var t,e=0;e<r.length;e++){for(var s=r[e],a=!0,o=1;o<s.length;o++){var l=s[o];0!==i[l]&&(a=!1)}a&&(r.splice(e--,1),t=n(n.s=s[0]))}return t}var a={},i={app:0},r=[];function n(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=a,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(s,a,function(e){return t[e]}.bind(null,a));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;r.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"56d7":function(t,e,s){"use strict";s.r(e);var a=s("2b0e"),i=s("8c4f"),r=s("9f6b");class n{constructor(t){this.db=new loki("falkns0113.db",{autoload:!0,autoloadCallback:()=>{this.music=this.db.getCollection("songs"),this.music||(this.music=this.db.addCollection("songs",{unique:["id"]})),this.music.count()>0&&"function"===typeof t?(t(),this.update()):this.update(t)},autosave:!0,autosaveInterval:4e3})}async update(t){t=t||null;try{this.music.chain().find().update(t=>{t.present=!1});let t=await window.fetch("/api/songs/all"),e=await t.json();const s=e.data.length;let a=s;do{e.data.forEach(t=>{this.addSong(t)}),t=await window.fetch("/api/songs/all/"+a+"/"+s),e=await t.json(),a+=e.data.length}while(e.data.length>0);this.music.chain().find({present:!1}).remove()}catch(e){console.log("Could not connect to API to update library",e)}null!==t&&t()}addSong(t){try{const e=this.music.findOne({_id:t.$loki})||null;if(null===e){const e=this.music.insert({_id:t.$loki,info:t.info,favorite:t.favorite,playCount:t.playCount,cached:!1,present:!0});e.meta=t.meta,this.music.update(e)}else JSON.stringify(e.info)!==JSON.stringify(t.info)&&(e.info=t.info),e.present=!0,this.music.update(e)}catch(e){console.error("Could not add song to database",e)}}async getStats(){const t={songs:0,albums:0,artists:0},e=this.music.find();return t.songs=e.length,t.artists=[...new Set(e.map(t=>t.info.albumartist))].length,t.albums=[...new Set(e.map(t=>t.info.album))].length,t}async getArtists(){const t=this.music.chain().find().compoundsort([["info.artist.art",!0],"info.albumartist"]).data();return t.filter((t,e,s)=>s.findIndex(e=>e.info.albumartist===t.info.albumartist)===e).map(t=>({title:t.info.albumartist,art:"/art/"+(""!==t.info.art.artist?t.info.art.artist:"placeholder.png"),url:"/artist/"+encodeURIComponent(t.info.albumartist),subtitle:"",surl:""}))}async getArtist(t){const e=this.music.chain().find({"info.albumartist":t}).compoundsort([["info.artist.art",!0],"info.albumartist"]).limit(1).data()[0].info.art.artist,s=this.music.chain().find({"info.albumartist":t}).simplesort("info.year").data(),a=s.map(t=>({art:"/art/"+(""!==t.info.art.cover?t.info.art.cover:"placeholder.png"),artistart:"/art/"+(""!==e?e:"placeholder.png"),title:t.info.album,url:`/album/${encodeURIComponent(t.info.albumartist)}/${encodeURIComponent(t.info.album)}`,subtitle:t.info.year,surl:""})).filter((t,e,s)=>s.findIndex(e=>e.title===t.title&&e.subtitle===t.subtitle)===e);return{albums:a}}async getAlbums(){const t=this.music.chain().find().simplesort("info.album").data(),e=t.map(t=>({art:"/art/"+(""!==t.info.art.cover?t.info.art.cover:"placeholder.png"),title:t.info.album,url:`/album/${encodeURIComponent(t.info.albumartist)}/${encodeURIComponent(t.info.album)}`,subtitle:t.info.albumartist,surl:"/artist/"+encodeURIComponent(t.info.albumartist)})).filter((t,e,s)=>s.findIndex(e=>e.title===t.title&&e.subtitle===t.subtitle)===e);return e}async getAlbum(t,e){const s=this.music.chain().find({"info.albumartist":t,"info.album":e}).compoundsort(["info.disc","info.track"]).data(),a=s.map(t=>(t.info._id=t._id,t.info.shortformat=t.info.format.samplerate/1e3+"kHz "+(t.info.format.bits?t.info.format.bits+"bit":""),t.info.artist=t.info.artists.length>0?t.info.artists[0]:t.info.albumartist,t.info.art.cover=""!==t.info.art.cover?t.info.art.cover:"placeholder.png",t.info));return{title:a[0].album,art:"/art/"+a[0].art.cover,artist:a[0].albumartist,year:a[0].year,genre:a[0].genre,shortformat:a[0].shortformat,tracks:a}}async getGenres(){const t=this.music.chain().find().simplesort("info.genre").data(),e=t.map(t=>({art:"/art/"+(t.info.art.cover?t.info.art.cover:"placeholder.png"),title:t.info.genre,url:"/genre/"+encodeURIComponent(t.info.genre),subtitle:"",surl:""})).filter((t,e,s)=>s.findIndex(e=>e.title===t.title&&""!==e.title)===e);return e}async getGenre(t){const e=this.music.chain().find({"info.genre":t}).simplesort("info.album").data(),s=e.map(t=>({art:"/art/"+(t.info.art.cover?t.info.art.cover:"placeholder.png"),title:t.info.album,url:`/album/${encodeURIComponent(t.info.albumartist)}/${encodeURIComponent(t.info.album)}`,subtitle:t.info.albumartist,surl:"/artist/"+encodeURIComponent(t.info.albumartist)})).filter((t,e,s)=>s.findIndex(e=>e.title===t.title&&e.subtitle===t.subtitle)===e);return s}}var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[t.loginScreen?s("Login",{attrs:{isLoggedInParent:t.isLoggedIn}}):t._e(),t.loginScreen?t._e():s("Main",{attrs:{isLoggedInParent:t.isLoggedIn}})],1)},l=[],c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container",staticStyle:{height:"100vh"}},[s("div",{staticClass:"row",staticStyle:{height:"100%","align-items":"center"}},[s("div",{staticClass:"col-xs-6 col-xs-offset-3 has-text-centered"},[s("img",{attrs:{src:"/img/falk-blue-white.svg"}}),s("h1",[t._v("Soundbyte")]),s("p",{staticClass:"subtitle is-4"},[t._v("Please login to access your music!")]),s("br"),s("fieldset",{staticStyle:{margin:"0 auto","max-width":"300px"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.user,expression:"user"}],staticClass:"input",attrs:{type:"text",placeholder:"Username",autofocus:"true"},domProps:{value:t.user},on:{input:function(e){e.target.composing||(t.user=e.target.value)}}})]),s("br"),s("fieldset",{staticStyle:{margin:"0 auto","max-width":"300px"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.pass,expression:"pass"}],staticClass:"input",attrs:{type:"password",placeholder:"Password"},domProps:{value:t.pass},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.login(e)},input:function(e){e.target.composing||(t.pass=e.target.value)}}})]),""!==t.error?s("span",{staticClass:"message-danger"},[t._v(t._s(t.error))]):t._e(),s("br"),s("button",{staticClass:"button is-rounded is-primary",on:{click:t.login}},[t._v("Log In")])])])])},u=[],d={name:"Login",props:["isLoggedInParent"],data(){return{user:"",pass:"",error:""}},methods:{login(){const t=JSON.stringify({username:this.user,password:this.pass});window.fetch("/api/login",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:t}).then(t=>t.json()).then(t=>{"failed"===t.state||!1===t.state?this.error="Invalid username and/or password":this.isLoggedInParent()}).catch(t=>{console.log(t)})}}},p=d,h=s("2877"),f=Object(h["a"])(p,c,u,!1,null,"87282724",null),m=f.exports,g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:{"no-controls":"/"===this.$route.path}},[s("div",{attrs:{id:"content-container"}},[s("router-view",{attrs:{playback:t.playback},on:{showQueue:t.toggleQueue}})],1),s("Menu",{attrs:{isActive:t.showMenu}}),s("ControlBar",{attrs:{isActive:t.showControls,playback:t.playback},on:{toggleQueue:t.toggleQueue}}),s("Queue",{attrs:{isActive:t.showQueue,playback:t.playback},on:{hideQueue:t.toggleQueue}})],1)},v=[],b=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("aside",{staticClass:"menu",class:{"is-active":t.isActive}},[s("figure",{staticClass:"image menu-brand"},[s("router-link",{attrs:{to:"/"}},[s("svg",{staticStyle:{isolation:"isolate"},attrs:{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 39.961 39.961",width:"40px",height:"40px"}},[s("circle",{attrs:{"vector-effect":"non-scaling-stroke",cx:"19.9805",cy:"19.9805",r:"15.5",fill:"rgb(255,255,255)"}}),s("path",{attrs:{d:" M 0 19.981 C 0 8.953 8.953 0 19.981 0 C 31.008 0 39.961 8.953 39.961 19.981 C 39.961 31.008 31.008 39.961 19.981 39.961 C 8.953 39.961 0 31.008 0 19.981 Z  M 15.089 28.897 L 15.089 28.897 L 10.274 28.897 L 10.274 28.897 Q 10.045 28.897 9.879 28.732 L 9.879 28.732 L 9.879 28.732 Q 9.714 28.566 9.714 28.413 L 9.714 28.413 L 9.714 28.413 Q 9.714 28.26 9.739 28.184 L 9.739 28.184 L 15.293 11.905 L 15.293 11.905 Q 15.522 11.064 16.439 11.064 L 16.439 11.064 L 23.522 11.064 L 23.522 11.064 Q 24.439 11.064 24.668 11.905 L 24.668 11.905 L 30.222 28.184 L 30.222 28.184 Q 30.248 28.26 30.248 28.413 L 30.248 28.413 L 30.248 28.413 Q 30.248 28.566 30.082 28.732 L 30.082 28.732 L 30.082 28.732 Q 29.916 28.897 29.687 28.897 L 29.687 28.897 L 24.872 28.897 L 24.872 28.897 Q 24.057 28.897 23.726 28.031 L 23.726 28.031 Q 20.444 17.551 19.981 15.981 Q 19.516 17.591 16.236 28.031 L 16.236 28.031 Q 15.904 28.897 15.089 28.897 L 15.089 28.897 L 15.089 28.897 Z ","fill-rule":"evenodd",fill:"rgb(77,132,195)"}})])])],1),s("ul",{staticClass:"menu-list has-text-centered"},[s("li",[s("router-link",{attrs:{to:"/"}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#play"}})]),s("div",{staticClass:"detail"},[t._v("Playing")])])],1),s("li",[s("router-link",{attrs:{to:"/playlists"}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#list"}})]),s("div",{staticClass:"detail"},[t._v("Playlists")])])],1),s("li",[s("router-link",{attrs:{to:"/artists"}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#mic"}})]),s("div",{staticClass:"detail"},[t._v("Artists")])])],1),s("li",[s("router-link",{attrs:{to:"/albums"}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#disc"}})]),s("div",{staticClass:"detail"},[t._v("Albums")])])],1),s("li",[s("router-link",{attrs:{to:"/genres"}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#music"}})]),s("div",{staticClass:"detail"},[t._v("Genres")])])],1),s("li",[s("router-link",{attrs:{to:"/settings"}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#settings"}})]),s("div",{staticClass:"detail"},[t._v("Settings")])])],1),s("li",[s("router-link",{attrs:{to:"/logout"}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#log-out"}})]),s("div",{staticClass:"detail"},[t._v("Log Out")])])],1)])])},y=[],w={name:"Menu",props:["isActive"]},C=w,k=Object(h["a"])(C,b,y,!1,null,"1e3452ab",null),_=k.exports,x=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"is-active",attrs:{id:"control-bar","data-bind":"swipeup: showQueue"}},[this.playback.queue[this.playback.queuePos]?s("div",{staticClass:"progress-topper",style:{width:t.playback.elapsed/t.playback.queue[t.playback.queuePos].duration*t.$innerWidth+"px"}}):t._e(),s("div",{staticClass:"row is-marginless"},[s("div",{staticClass:"col-xs col-md"},[s("div",{staticClass:"row now-playing"},[s("div",{staticClass:"col-xs is-narrow"},[s("figure",{staticClass:"image is-70x70"},[s("img",{attrs:{src:"/art/"+(this.playback.queue[this.playback.queuePos]?this.playback.queue[this.playback.queuePos].art.cover:"placeholder.png")}})])]),s("div",{staticClass:"col-xs"},[s("p",{staticClass:"is-5"},[t._v(t._s(this.playback.queue[this.playback.queuePos]?this.playback.queue[this.playback.queuePos].title:"Not playing"))]),this.playback.queue[this.playback.queuePos]?s("p",{staticClass:"subtitle is-5"},[s("router-link",{staticClass:"subtitle is-5",attrs:{to:"/artist/"+this.playback.queue[this.playback.queuePos].artist}},[t._v(t._s(this.playback.queue[this.playback.queuePos].artist))])],1):t._e()])])]),s("div",{staticClass:"col-xs no-grow col-md playing-controls misc-controls"},[s("svg",{staticClass:"random feather hidden--to-desktop",on:{click:this.$player.random}},[s("use",{attrs:{href:"/img/feather-sprite.svg#shuffle"}})]),s("svg",{staticClass:"feather prev",on:{click:this.$player.prev}},[s("use",{attrs:{href:"/img/feather-sprite.svg#skip-back"}})]),s("span",{staticClass:"play-button pointer",on:{click:this.$player.toggle}},[s("svg",{staticClass:"feather",class:{"is-hidden":t.playback.isPlaying}},[s("use",{attrs:{href:"/img/feather-sprite.svg#play"}})]),s("svg",{staticClass:"feather",class:{"is-hidden":!t.playback.isPlaying}},[s("use",{attrs:{href:"/img/feather-sprite.svg#pause"}})])]),s("svg",{staticClass:"feather next",on:{click:this.$player.skip}},[s("use",{attrs:{href:"/img/feather-sprite.svg#skip-forward"}})]),s("svg",{staticClass:"repeat feather hidden--to-desktop",on:{click:this.$player.repeat}},[s("use",{attrs:{href:"/img/feather-sprite.svg#repeat"}})])]),s("div",{staticClass:"col-md has-text-right hidden--to-desktop"},[s("div",{staticClass:"row end-md"},[s("div",{staticClass:"col-md no-grow play-progress"},[s("span",[t._v(t._s(Math.floor(t.playback.elapsed/60)+":"+("0"+Math.round(t.playback.elapsed)%60).slice(-2,3)))]),t._v("/"),s("span",[t._v(t._s(this.playback.queue[this.playback.queuePos]?Math.floor(this.playback.queue[this.playback.queuePos].duration/60)+":"+("0"+this.playback.queue[this.playback.queuePos].duration%60).slice(-2,3):"0:00"))])]),s("div",{staticClass:"col-md no-grow"},[s("svg",{staticClass:"queue feather hidden--to-desktop",on:{click:t.toggleQueue}},[s("use",{attrs:{href:"/img/feather-sprite.svg#queue-alt"}})])])])])])])},q=[],P={name:"ControlBar",props:["isActive","playback"],methods:{toggleQueue(){this.$emit("toggleQueue")}}},U=P,$=Object(h["a"])(U,x,q,!1,null,null,null),A=$.exports,L=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:{"is-active":t.isActive},attrs:{id:"queue-list"}},[s("div",{attrs:{id:"queue-header"},on:{click:t.hideQueue}},[s("h1",[t._v("Play Queue")])]),s("div",{attrs:{id:"queue-items"}},[s("table",t._l(t.playback.queue,(function(e,a){return s("tr",{class:{"is-playing":a===t.playback.queuePos}},[s("td",{on:{click:function(e){return t.$player.changePos(a)}}},[s("figure",{staticClass:"image is-40x40"},[s("img",{attrs:{src:"/art/"+e.art.cover,load:"lazy"}})])]),s("td",{on:{click:function(e){return t.$player.changePos(a)}}},[s("p",{staticClass:"is-5"},[t._v(t._s(e.title))]),s("p",{staticClass:"subtitle is-5"},[t._v(t._s(e.artist+" - "+Math.floor(e.duration/60)+":"+("0"+e.duration%60).slice(-2,3)))])]),s("td",{attrs:{"data-bind":"click: $parent.queue.remove"}},[s("span",{staticClass:"delete"},[s("svg",{staticClass:"feather delete"},[s("use",{attrs:{"xlink:href":"/img/feather-sprite.svg#x-circle"}})])])])])})),0)])])},j=[],S={name:"Queue",props:["isActive","playback"],methods:{hideQueue(){this.$emit("hideQueue")}}},T=S,I=Object(h["a"])(T,L,j,!1,null,null,null),O=I.exports,E={name:"Main",components:{Menu:_,ControlBar:A,Queue:O},created(){this.$player.on("play",()=>{this.playback.isPlaying=!0}),this.$player.on("pause",()=>{this.playback.isPlaying=!1}),this.$player.on("queue",t=>{this.playback.queue=t.queue,this.playback.queuePos=t.pos}),this.$player.on("progress",t=>this.playback.elapsed=t.detail.elapsed)},data(){return{showMenu:!1,showControls:!1,showQueue:!1,noControls:!1,playback:{isPlaying:!1,queuePos:0,elapsed:0,queue:[]}}},props:["isLoggedInParent"],methods:{toggleQueue(t=null){this.showQueue=!this.showQueue}}},Q=E,M=Object(h["a"])(Q,g,v,!1,null,null,null),N=M.exports,z={name:"App",components:{Login:m,Main:N},data(){return{loginScreen:!1}},methods:{isLoggedIn(t=!0){this.loginScreen=!t}}},R=z,B=Object(h["a"])(R,o,l,!1,null,null,null),J=B.exports,G=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container-fluid max"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-xs-10 col-md-3 has-margin-auto art"},[s("figure",{staticClass:"image is-1by1",attrs:{id:"home-albumart"}},[s("img",{staticStyle:{"z-index":"1"},attrs:{src:"/art/"+(this.playback.queue[this.playback.queuePos]?this.playback.queue[this.playback.queuePos].art.cover:"placeholder.png")+"?size=600"}})]),this.playback.queue[this.playback.queuePos]&&""!==this.playback.queue[this.playback.queuePos].art.disc?s("figure",{staticClass:"image is-1by1",staticStyle:{"margin-top":"-65%","background-color":"transparent"},attrs:{id:"home-albumart"}},[s("img",{class:{rotate:this.playback.isPlaying},attrs:{src:"/art/"+this.playback.queue[this.playback.queuePos].art.disc+"?size=600"}})]):t._e(),this.playback.queue[this.playback.queuePos]&&""!==this.playback.queue[this.playback.queuePos].album?s("div",{staticClass:"has-text-centered",attrs:{id:"mobile-toolbar"}},[s("div",[s("svg",{staticClass:"feather"},[s("use",{attrs:{"xlink:href":"/img/feather-sprite.svg#heart"}})])]),s("div",[s("svg",{staticClass:"feather"},[s("use",{attrs:{"xlink:href":"/img/feather-sprite.svg#plus"}})])])]):t._e()]),s("div",{staticClass:"col-xs-10 col-xs-offset-1"},[s("h1",{staticClass:"has-text-centered has-no-overflow",attrs:{id:"home-title"}},[t._v(t._s(this.playback.queue[this.playback.queuePos]?this.playback.queue[this.playback.queuePos].title:"Nothing playing"))]),this.playback.queue[this.playback.queuePos]?s("p",{staticClass:"has-text-centered subtitle is-3 has-no-overflow hidden--to-desktop"},[s("router-link",{attrs:{id:"home-album",to:"/album/"+this.playback.queue[this.playback.queuePos].artist+"/"+this.playback.queue[this.playback.queuePos].album}},[t._v(t._s(this.playback.queue[this.playback.queuePos].album))])],1):t._e(),this.playback.queue[this.playback.queuePos]?s("p",{staticClass:"has-text-centered subtitle is-3 has-no-overflow"},[s("router-link",{attrs:{id:"home-artist",to:"/artist/"+this.playback.queue[this.playback.queuePos].artist}},[t._v(t._s(this.playback.queue[this.playback.queuePos].artist))])],1):t._e(),this.playback.queue[this.playback.queuePos]&&""!==this.playback.queue[this.playback.queuePos].shortformat?s("p",{staticClass:"has-text-centered"},[s("span",{staticClass:"tag is-small",attrs:{id:"home-quality"}},[t._v(t._s(this.playback.queue[this.playback.queuePos].shortformat))])]):t._e()]),s("div",{staticClass:"col-xs-12 mobile-controls hidden--for-desktop",attrs:{id:"mobile-controls"}},[s("span",[s("svg",{staticClass:"feather random is-small"},[s("use",{attrs:{"xlink:href":"/img/feather-sprite.svg#shuffle"}})])]),s("span",[s("svg",{staticClass:"feather"},[s("use",{attrs:{"xlink:href":"/img/feather-sprite.svg#skip-back"}})])]),s("button",{staticClass:"button is-primary is-rounded has-no-margin"},[s("svg",{staticClass:"feather",class:{"is-hidden":this.playback.isPlaying}},[s("use",{attrs:{href:"/img/feather-sprite.svg#play"}})]),s("svg",{staticClass:"feather",class:{"is-hidden":!this.playback.isPlaying}},[s("use",{attrs:{href:"/img/feather-sprite.svg#pause"}})])]),s("span",[s("svg",{staticClass:"feather"},[s("use",{attrs:{"xlink:href":"/img/feather-sprite.svg#skip-forward"}})])]),s("span",[s("svg",{staticClass:"feather repeat is-small"},[s("use",{attrs:{"xlink:href":"/img/feather-sprite.svg#repeat"}})])])]),t._m(0)]),s("div",{staticClass:"hidden--for-desktop",attrs:{id:"swipe-up-queue"},on:{click:t.showQueue}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{"xlink:href":"/img/feather-sprite.svg#chevron-up"}})])])])},V=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col-xs-10 col-xs-offset-1 hidden--for-desktop"},[s("div",{attrs:{id:"mobile-progress-bar"}},[s("div",{staticStyle:{width:"0px"}})])])}],D={name:"Home",props:["playback"],methods:{showQueue(){this.$emit("showQueue",!0)}}},W=D,H=Object(h["a"])(W,G,V,!1,null,null,null),Z=H.exports,Y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container-fluid"},[s("h1",{staticClass:"is-capitalized"},[t._v("Albums")]),s("Tiles",{attrs:{tiles:t.albums}})],1)},F=[],K=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row art-container"},t._l(t.tiles,(function(e){return s("div",{staticClass:"col-lg-2 col-xs-4 art has-text-centered item-tile"},[s("router-link",{attrs:{to:e.url}},[s("figure",{staticClass:"image is-1by1"},[s("img",{attrs:{src:e.art,load:"lazy"}})]),s("p",{staticClass:"is-5 is-capitalized"},[t._v(t._s(e.title))])]),""!==e.surl?s("router-link",{attrs:{to:e.surl}},[s("p",{staticClass:"subtitle is-5 is-capitalized"},[t._v(t._s(e.subtitle))])]):s("p",{staticClass:"subtitle is-5 is-capitalized"},[t._v(t._s(e.subtitle))])],1)})),0)},X=[],tt={name:"Tiles",props:["tiles"]},et=tt,st=Object(h["a"])(et,K,X,!1,null,"1e17344e",null),at=st.exports,it={name:"Albums",components:{Tiles:at},created(){this.$database.getAlbums().then(t=>{this.albums=t})},data(){return{albums:[]}}},rt=it,nt=Object(h["a"])(rt,Y,F,!1,null,null,null),ot=nt.exports,lt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container-fluid"},[s("h1",{staticClass:"is-capitalized"},[t._v("Artists")]),s("Tiles",{attrs:{tiles:t.artists}})],1)},ct=[],ut={name:"Artists",components:{Tiles:at},created(){this.$database.getArtists().then(t=>{this.artists=t})},data(){return{artists:[]}}},dt=ut,pt=Object(h["a"])(dt,lt,ct,!1,null,null,null),ht=pt.exports,ft=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container-fluid"},[s("div",{staticClass:"row center"},[s("div",{staticClass:"col-md-1 hidden--to-tablet"},[s("figure",{staticClass:"image is-rounded has-no-overflow"},[s("img",{attrs:{src:this.albums.length?this.albums[0].artistart:""}})])]),s("div",{staticClass:"col-xs-12 col-md-6"},[s("h1",[t._v(t._s(this.$route.params.artist))])])]),s("Tiles",{attrs:{tiles:t.albums}})],1)},mt=[],gt={name:"Artist",components:{Tiles:at},created(){this.$database.getArtist(this.$route.params.artist).then(t=>{this.albums=t.albums})},data(){return{albums:[]}}},vt=gt,bt=Object(h["a"])(vt,ft,mt,!1,null,null,null),yt=bt.exports,wt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container-fluid"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-xs-12 col-md-5 has-text-centered-desktop"},[s("div",{staticClass:"row album-detail"},[s("div",{staticClass:"col-md-8 col-md-offset-2 col-xs-4 art"},[s("figure",{staticClass:"image"},[s("img",{attrs:{src:this.art+"?size=800"}})])]),s("div",{staticClass:"col-md-8 col-md-offset-2 col-xs-8"},[s("h1",{staticClass:"album-title"},[t._v(t._s(this.title))]),s("p",{staticClass:"subtitle is-1"},[s("router-link",{attrs:{to:"/artist/"+encodeURIComponent(this.$route.params.artist)}},[t._v(t._s(this.$route.params.artist))])],1),s("p",{staticClass:"is-4 detail"},[t._v(t._s(this.year))]),s("p",{staticClass:"is-4"},[s("router-link",{attrs:{to:"/genre/"+encodeURIComponent(this.genre)}},[t._v(t._s(this.genre))])],1),s("p",{staticClass:"is-6 tag is-rounded detail"},[t._v(t._s(t.shortformat))])])])]),s("div",{staticClass:"col-xs-12 col-md-7"},[s("div",{staticClass:"col-xs-12 col-md-11"},[s("div",{staticClass:"row album-detail"},[s("h1",{staticClass:"hidden--to-tablet"},[t._v("Album Tracks")]),s("table",{staticClass:"table songs"},[s("tbody",t._l(this.tracks,(function(e,a){return s("tr",{attrs:{"data-id":e._id}},[s("td",{staticClass:"pointer",on:{click:function(e){return t.playAll(a)}}},[s("p",{staticClass:"is-5"},[t._v(t._s(e.track+". "+e.title))]),s("p",{staticClass:"subtitle is-5"},[t._v(t._s(e.artist+" - "+Math.floor(e.duration/60)+":"+("0"+e.duration%60).slice(-2,3)))])]),s("td",{staticClass:"hidden--to-tablet"},[s("span",{staticClass:"tag"},[t._v(t._s(e.shortformat))])]),s("td",{staticClass:"is-narrow"},[s("div",{staticClass:"dropdown is-right"},[s("span",{attrs:{onclick:"this.closest('div').classList.toggle('is-active')"}},[s("svg",{staticClass:"feather"},[s("use",{attrs:{"xlink:href":"/img/feather-sprite.svg#more-vertical"}})])]),t._m(0,!0)])])])})),0)])])])])])])},Ct=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"dropdown-content"},[s("span",{staticClass:"dropdown-item"},[t._v("Play")]),s("span",{staticClass:"dropdown-item"},[t._v("Add to queue")]),s("span",{staticClass:"dropdown-item"},[t._v("Clear and play")]),s("span",{staticClass:"dropdown-item"},[t._v("Add to playlist")])])}],kt={name:"Album",components:{Tiles:at},created(){this.$database.getAlbum(this.$route.params.artist,this.$route.params.album).then(t=>{this.art=t.art,this.genre=t.genre,this.shortformat=t.shortformat,this.title=t.title,this.tracks=t.tracks,this.year=t.year})},data(){return{art:"",genre:"",shortformat:"",title:"",tracks:[],year:""}},methods:{playAll(t){const e=this.tracks.map(t=>({id:t._id,url:"/song/"+t._id+t.location.substr(t.location.lastIndexOf(".")),meta:t}));this.$player.setTracks(e,t,!0)}}},_t=kt,xt=Object(h["a"])(_t,wt,Ct,!1,null,null,null),qt=xt.exports,Pt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container-fluid"},[s("h1",{staticClass:"is-capitalized"},[t._v("Genres")]),s("Tiles",{attrs:{tiles:t.genres}})],1)},Ut=[],$t={name:"Genres",components:{Tiles:at},created(){this.$database.getGenres().then(t=>{this.genres=t})},data(){return{genres:[]}}},At=$t,Lt=Object(h["a"])(At,Pt,Ut,!1,null,null,null),jt=Lt.exports,St=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container-fluid"},[s("h1",{staticClass:"is-capitalized"},[t._v(t._s(this.$route.params.genre))]),s("Tiles",{attrs:{tiles:t.albums}})],1)},Tt=[],It={name:"Genre",components:{Tiles:at},created(){this.$database.getGenre(this.$route.params.genre).then(t=>{this.albums=t})},data(){return{albums:[]}}},Ot=It,Et=Object(h["a"])(Ot,St,Tt,!1,null,null,null),Qt=Et.exports,Mt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container-fluid"},[s("h1",[t._v("Settings")]),s("p",{staticClass:"is-1"},[t._v("Music Library")]),s("div",{staticClass:"box row has-text-centered"},[s("div",{staticClass:"col-xs-4"},[s("h1",[t._v(t._s(this.stats.songs))]),s("p",{staticClass:"subtitle is-3"},[t._v("Songs")])]),s("div",{staticClass:"col-xs-4"},[s("h1",[t._v(t._s(this.stats.artists))]),s("p",{staticClass:"subtitle is-3"},[t._v("Artists")])]),s("div",{staticClass:"col-xs-4"},[s("h1",[t._v(t._s(this.stats.albums))]),s("p",{staticClass:"subtitle is-3"},[t._v("Albums")])])]),s("table",{staticClass:"table"},[t._m(0),s("tbody",t._l(t.locations,(function(e){return s("tr",[s("td",[s("p",{staticClass:"is-6"},[t._v(t._s(e))])]),s("td",{staticClass:"is-narrow pointer",on:{click:function(s){return t.removeLocation(e)}}},[s("span",{staticClass:"delete"},[s("svg",{staticClass:"feather delete"},[s("use",{attrs:{"xlink:href":"/img/feather-sprite.svg#x-circle"}})])])])])})),0)]),s("div",{staticStyle:{display:"flex","align-items":"center"}},[s("button",{staticClass:"button no-v is-rounded is-primary",on:{click:function(e){t.directories.show=!0}}},[t._v("Add Location")]),s("button",{staticClass:"button no-v is-primary is-rounded",on:{click:function(e){return t.updateLibrary()}}},[t._v("Update Library")])]),s("div",{attrs:{"data-bind":"if: settings.isAdmin"}},[s("br"),s("p",{staticClass:"is-1"},[t._v("Users")]),s("table",{staticClass:"table"},[t._m(1),s("tbody",t._l(this.users,(function(e){return s("tr",[s("td",[s("p",{staticClass:"is-6"},[t._v(t._s(e.user))])]),"admin"!==e.user?s("td",{staticClass:"is-narrow pointer"},[s("span",{staticClass:"delete",on:{click:function(s){return t.removeUser(e.uuid)}}},[s("svg",{staticClass:"feather delete"},[s("use",{attrs:{"xlink:href":"/img/feather-sprite.svg#x-circle"}})])])]):t._e()])})),0)]),s("button",{staticClass:"button no-v is-rounded is-primary",on:{click:function(e){t.newUser.show=!0}}},[t._v("Add user")])]),s("div",{staticClass:"modal is-small modal-fx-fadeInScale",class:{"is-active":this.directories.show},attrs:{id:"dir-modal"}},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"box"},[s("h1",[t._v("Add directory")]),s("div",[s("input",{staticClass:"input",attrs:{type:"text",readonly:""},domProps:{value:this.directories.current}}),s("p")]),s("div",{staticStyle:{padding:"2px 0","max-height":"70vh","overflow-y":"auto"}},[s("table",t._l(this.directories.list,(function(e){return s("tr",{staticClass:"pointer",on:{click:function(s){return t.getDirectories(e.name)}}},[s("td",{staticClass:"is-narrow"},[s("svg",{staticClass:"feather"},[s("use",{attrs:{href:"/img/feather-sprite.svg#folder"}})])]),s("td",[t._v(t._s(e.name))])])})),0)]),s("p"),s("button",{staticClass:"button is-rounded",on:{click:function(e){t.directories.show=!1}}},[t._v("Cancel")]),s("button",{staticClass:"button is-primary is-rounded",on:{click:function(e){t.directories.show=!1,t.addLocation()}}},[t._v("Add directory")])])])]),s("div",{staticClass:"modal is-small modal-fx-fadeInScale",class:{"is-active":this.newUser.show},attrs:{id:"user-modal"}},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"box"},[s("h1",[t._v("Add user")]),s("fieldset",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newUser.user,expression:"newUser.user"}],staticClass:"input",attrs:{type:"text",value:"",placeholder:"Username"},domProps:{value:t.newUser.user},on:{input:function(e){e.target.composing||t.$set(t.newUser,"user",e.target.value)}}})]),s("fieldset",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newUser.pass,expression:"newUser.pass"}],staticClass:"input",attrs:{type:"password",value:"",placeholder:"Password"},domProps:{value:t.newUser.pass},on:{input:function(e){e.target.composing||t.$set(t.newUser,"pass",e.target.value)}}})]),s("fieldset",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newUser.passVerify,expression:"newUser.passVerify"}],staticClass:"input",attrs:{type:"password",value:"",placeholder:"Verify password"},domProps:{value:t.newUser.passVerify},on:{input:function(e){e.target.composing||t.$set(t.newUser,"passVerify",e.target.value)}}})]),s("fieldset",{staticStyle:{display:"flex","align-items":"center"}},[s("label",{staticClass:"switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newUser.inherit,expression:"newUser.inherit"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.newUser.inherit)?t._i(t.newUser.inherit,null)>-1:t.newUser.inherit},on:{change:function(e){var s=t.newUser.inherit,a=e.target,i=!!a.checked;if(Array.isArray(s)){var r=null,n=t._i(s,r);a.checked?n<0&&t.$set(t.newUser,"inherit",s.concat([r])):n>-1&&t.$set(t.newUser,"inherit",s.slice(0,n).concat(s.slice(n+1)))}else t.$set(t.newUser,"inherit",i)}}}),s("span",{staticClass:"slider round"})]),s("span",{staticStyle:{"margin-left":"5px"}},[t._v("Inherit my library")])]),s("fieldset",{staticStyle:{display:"flex","align-items":"center"}},[s("label",{staticClass:"switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newUser.admin,expression:"newUser.admin"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.newUser.admin)?t._i(t.newUser.admin,null)>-1:t.newUser.admin},on:{change:function(e){var s=t.newUser.admin,a=e.target,i=!!a.checked;if(Array.isArray(s)){var r=null,n=t._i(s,r);a.checked?n<0&&t.$set(t.newUser,"admin",s.concat([r])):n>-1&&t.$set(t.newUser,"admin",s.slice(0,n).concat(s.slice(n+1)))}else t.$set(t.newUser,"admin",i)}}}),s("span",{staticClass:"slider round"})]),s("span",{staticStyle:{"margin-left":"5px"}},[t._v("Admin")])]),s("p",{staticClass:"has-text-danger"},[t._v(t._s(this.newUser.error))]),s("br"),s("fieldset",[s("button",{staticClass:"button is-rounded",on:{click:function(e){t.newUser.show=!1}}},[t._v("Cancel")]),s("button",{staticClass:"button is-primary is-rounded",on:{click:function(e){return t.addUser()}}},[t._v("Add user")])])])])])])},Nt=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",[t._v("Library Locations")]),s("th")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",{attrs:{colspan:"2"}},[t._v("Registered users")])])])}],zt={name:"Settings",created(){this.$database.getStats().then(t=>{this.stats=t}),window.fetch("/api/locations").then(t=>t.json()).then(t=>{this.locations=t.locations,this.isAdmin=t.admin,this.isAdmin&&window.fetch("/api/users").then(t=>t.json()).then(t=>{this.users=t})}),this.getDirectories("")},data(){return{stats:{},locations:[],isAdmin:!1,users:[],newUser:{show:!1,user:"",pass:"",passVerify:"",inherit:!1,admin:!1,error:""},directories:{show:!1,list:[],current:""}}},methods:{addLocation(){const t=JSON.stringify({location:this.directories.current});window.fetch("/api/locations",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:t}).then(t=>t.json()).then(t=>{this.locations=t,this.directories.curent=""})},removeLocation(t){const e=JSON.stringify({location:t});window.fetch("/api/locations",{method:"delete",headers:{Accept:"application/json","Content-Type":"application/json"},body:e}).then(t=>t.json()).then(t=>{this.locations=t})},getDirectories(t){let e;const s=this.directories.current;""===t?e="":".."===t?(e=s.substr(0,s.lastIndexOf("/")),""===e&&(e="/")):e="/"===s?"/"+t:s+"/"+t;const a=JSON.stringify({location:e});window.fetch("/api/directories",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:a}).then(t=>t.json()).then(t=>{this.directories.current=t.location,this.directories.list=t.directories})},updateLibrary(){window.fetch("/api/update").catch(t=>{console.log(t)})},addUser(){if(this.newUser.user.length>0&&this.newUser.pass.length>7&&this.newUser.pass===this.newUser.passVerify){const t=JSON.stringify({user:this.newUser.user,pass:this.newUser.pass,admin:this.newUser.admin,inherit:this.newUser.inherit});this.newUser.error="",window.fetch("/api/users",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:t}).then(t=>t.json()).then(t=>{this.users=t,this.newUser.show=!1,this.newUser.user="",this.newUser.pass="",this.newUser.passVerify="",this.newUser.admin=!1,this.newUser.inherit=!1})}else console.log(this.newUser.pass,this.newUser.pass.length),this.newUser.pass.length<8?this.newUser.error="Password too short":this.newUser.pass!==this.newUser.passVerify?this.newUser.error="Passwords don't match":this.newUser.error="You must supply a username"},removeUser(t){const e=JSON.stringify({uuid:t});window.fetch("/api/users",{method:"delete",headers:{Accept:"application/json","Content-Type":"application/json"},body:e}).then(t=>t.json()).then(t=>{this.users=t})}}},Rt=zt,Bt=Object(h["a"])(Rt,Mt,Nt,!1,null,null,null),Jt=Bt.exports;a["a"].use(i["a"]);const Gt=(t,e,s)=>{if(s)return s;{const e={};return t.hash&&(e.selector=t.hash,console.log(t),"#anchor2"===t.hash&&(e.offset={y:100})),t.matched.some(t=>t.meta.scrollToTop)&&(e.x=0,e.y=0),e}},Vt=new i["a"]({mode:"hash",scrollBehavior:Gt,routes:[{path:"/",component:Z,props:!0,meta:{scrollToTop:!0}},{path:"/albums",component:ot,meta:{scrollToTop:!0}},{path:"/artists",component:ht,meta:{scrollToTop:!0}},{path:"/artist/:artist",component:yt,meta:{scrollToTop:!0}},{path:"/album/:artist/:album",component:qt,meta:{scrollToTop:!0}},{path:"/genres",component:jt,meta:{scrollToTop:!0}},{path:"/genre/:genre",component:Qt,meta:{scrollToTop:!0}},{path:"/settings",component:Jt,meta:{scrollToTop:!0}}]});a["a"].prototype.$innerWidth=window.innerWidth,a["a"].prototype.$player=r,a["a"].prototype.$database=new n(()=>{new a["a"]({router:Vt,render:t=>t(J)}).$mount("#app")})},"9f6b":function(t,e){const s=new(window.AudioContext||window.webkitAudioContext),a=0,i=1,r=0,n=1,o=2,l=100,c=[];let u=r,d=!1,p=-1,h=-1,f=[],m=0,g={};const v=new window.Audio;v.controls=!1,v.addEventListener("canplaythrough",()=>{v.play(),F()}),v.addEventListener("play",()=>{x("play",new window.Event("play")),p=s.currentTime,h=v.duration});const b=s.createMediaElementSource(v);b.connect(s.destination),X();const y=s.createGain();y.connect(s.destination);const w=l,C=new window.Worker("/js/player-worker.js"),k=t=>{const e=t.data;if(console.log("[MAIN]",e),e.cached)for(let s=m;s<f.length;s++){const t=f[s];t.id===e.id&&(t.cached=!0,s===m?O():s===m+1&&E())}};function _(t,e){g=g||{},g[t]=g[t]||[],g[t].push(e)}function x(t,e){g=g||{},t in g&&g[t].length>0&&g[t].forEach(t=>t(e))}function q(){const t=["stop","play","pause"];return t[u]}function P(){return u===o}function U(){return u===n}function $(){return m}function A(){return f.length>0?f[m].id:null}function L(){return{queue:f.map(t=>t.meta),pos:m}}function j(t){c[t]=s.createBufferSource(),c[t].connect(y),c[t].addEventListener("ended",t=>{u===n&&(c.length?(p=s.currentTime,h=c[0].buffer.duration):(p=-1,h=-1),m++,x("queue",L()),t.target.disconnect(0),t.target.buffer&&(t.target.buffer=null),c.shift(),f[m+1]?(x("next",new window.Event("next")),E(),F()):(m=0,x("stop",new window.Event("stop"))))})}function S(){for(let t=c.length-1;t>=0;t--)c[t].disconnect(0),c.pop()}function T(t){return new Promise((e,a)=>{const i=window.indexedDB.open("falk",3).onsuccess=i=>{const r=i.target.result.transaction("cache","readonly"),n=r.objectStore("cache"),o=f[t];n.get(o.id).onsuccess=t=>{t.target.result?t.target.result.data.arrayBuffer().then(t=>{console.log("[MAIN] Loaded track ",o.id),s.decodeAudioData(t,(function(t){e(t)}))}).catch(t=>a(new Error("Cache invalid"))):(a(new Error("Not in cache")),console.log(o))},r.onerror=t=>a(t)};i.onerror=t=>a(t)})}function I(t){return new Promise((e,s)=>{const a=window.indexedDB.open("falk",3).onsuccess=a=>{const i=a.target.result.transaction("cache","readonly"),r=i.objectStore("cache");r.get(t).onsuccess=t=>{t.target.result?e(!0):e(!1)},i.onerror=t=>s(t)};a.onerror=t=>s(t)})}function O(){T(m,!0).then(t=>{j(0),c[0].buffer=t,console.log("Switching to Web Audio API");const e=v.currentTime;d=i,u===n&&(v.pause(),v.src="",c[0].start(0,e))})}function E(){T(m+1,!0).then(t=>{j(1),c[1].buffer=t;const e=p+h;c[1].start(e),console.log("[MAIN] Next song scheduled")})}C.addEventListener("message",k),window.onbeforeunload=()=>(S(),null);const Q=()=>{if(u===n){window.setTimeout(Q,w);const t=v.duration||(c[0]?c[0].buffer.duration:null)||!1;!1!==t&&x("progress",new window.CustomEvent("progress",{detail:{elapsed:t-(h-(s.currentTime-p)),duration:t}}))}};function M(t=-1){if(s.resume(),u===o&&d===a)return void v.play();if(t<0&&(t=m),f.length<0||t>=f.length)throw new Error("Invalid queue position");u===n&&(d===a?(v.pause(),v.src="",h=0,p=0):(u=r,S()));const e=f[t];e.cached?T(t,!0).then(e=>{j(0),c[0].buffer=e;const a=u===o?c[0].buffer.duration-h:0;c[0].start(0,a),p=s.currentTime,u!==o&&(h=c[0].buffer.duration),x("play",new window.Event("play")),d=i,f[t+1]&&f[t+1].cached&&E()}):(v.src=e.url,d=a),u=n,Q()}function N(){u===n&&(u=o,x("pause",new window.Event("pause")),d===a?(h-=s.currentTime-p,v.pause()):d===i&&(h-=s.currentTime-p,S()))}function z(){u===n?N():M()}function R(){d===a?(v.pause(),v.src=""):S(),u=r,x("stop",new window.Event("stop")),h=0,p=0,m=0}function B(){Y(m+1),x("next",new window.Event("next"))}function J(){Y(m-1)}function G(){}function V(){}async function D({id:t,url:e,meta:s}){if(t=parseInt(t)||!1,e=e||!1,!1!==t&&!1!==e){let i=!1;try{i=await I(t)}catch(a){console.log(a)}console.log(t,e);const r={id:t,url:e,data:null,cached:i,meta:s};f.push(r)}}async function W({id:t,url:e,meta:s}){D(t,e,s),x("queue",L())}async function H(t){if(Array.isArray(t))for(let e=0;e<t.length;e++)await D(t[e]);x("queue",L())}async function Z(t,e=0,s=!1){K(),C.postMessage({clear:!0}),m=e,await H(t),s&&M()}function Y(t){R(),f[t]&&(m=t),M()}function F(){const t=f.slice(m).filter(t=>!1===t.cached).slice(0,5);C.postMessage({items:t})}function K(){u=r,d=!1,S(),v.src="",p=-1,h=-1,f=[],m=0}function X(){window.indexedDB.open("falk",3).onupgradeneeded=function(t){console.log("test");const e=t.target.result.createObjectStore("cache",{keyPath:"id"});e.createIndex("date","added")}}t.exports={getState:q,getPos:$,isPlay:U,isPaused:P,getCurrentTrackID:A,on:_,play:M,toggle:z,stop:R,skip:B,prev:J,enqueue:H,enqueueOne:W,setTracks:Z,random:G,repeat:V,changePos:Y,getQueue:L}}});
//# sourceMappingURL=app.1a94df0a.js.map