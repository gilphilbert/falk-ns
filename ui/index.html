<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4d84c3">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#2A2A2A">
    <base href="/">
    <title></title>
    <link rel="stylesheet" href="/css/falk.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min.js"></script>
    <script src="//unpkg.com/navigo"></script>
    <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lokijs/1.5.11/lokijs.min.js"></script>
  
  </head>
  <body>
    <div data-bind="component: { name: mainContainer, params: { mainContainer: mainContainer } }"></div>

    <template id="t-app">
      <div id="content-container" data-bind="template: pageContainer, swiperight: menuShow, swipeleft: menuHide"></div>

      <aside class="menu" data-bind="css: { 'is-active': menuState }">
        <figure class="image menu-brand">
          <a data-navigo href="/">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="isolation:isolate" viewBox="0 0 39.961 39.961" width="40px" height="40px"><circle vector-effect="non-scaling-stroke" cx="19.9805" cy="19.9805" r="15.5" fill="rgb(255,255,255)"/><path d=" M 0 19.981 C 0 8.953 8.953 0 19.981 0 C 31.008 0 39.961 8.953 39.961 19.981 C 39.961 31.008 31.008 39.961 19.981 39.961 C 8.953 39.961 0 31.008 0 19.981 Z  M 15.089 28.897 L 15.089 28.897 L 10.274 28.897 L 10.274 28.897 Q 10.045 28.897 9.879 28.732 L 9.879 28.732 L 9.879 28.732 Q 9.714 28.566 9.714 28.413 L 9.714 28.413 L 9.714 28.413 Q 9.714 28.26 9.739 28.184 L 9.739 28.184 L 15.293 11.905 L 15.293 11.905 Q 15.522 11.064 16.439 11.064 L 16.439 11.064 L 23.522 11.064 L 23.522 11.064 Q 24.439 11.064 24.668 11.905 L 24.668 11.905 L 30.222 28.184 L 30.222 28.184 Q 30.248 28.26 30.248 28.413 L 30.248 28.413 L 30.248 28.413 Q 30.248 28.566 30.082 28.732 L 30.082 28.732 L 30.082 28.732 Q 29.916 28.897 29.687 28.897 L 29.687 28.897 L 24.872 28.897 L 24.872 28.897 Q 24.057 28.897 23.726 28.031 L 23.726 28.031 Q 20.444 17.551 19.981 15.981 Q 19.516 17.591 16.236 28.031 L 16.236 28.031 Q 15.904 28.897 15.089 28.897 L 15.089 28.897 L 15.089 28.897 Z " fill-rule="evenodd" fill="rgb(77,132,195)"/></svg>
          </a>
        </figure>
        <ul class="menu-list has-text-centered">
          <li><a href="/" data-navigo><svg class="feather"><use href="/img/feather-sprite.svg#play"></use></svg><div class="detail">Playing</div></a></li>
          <li><a href="/playlists" data-navigo><svg class="feather"><use href="/img/feather-sprite.svg#list"></use></svg><div class="detail">Playlists</div></a></li>
          <li><a href="/artists" data-navigo><svg class="feather"><use href="/img/feather-sprite.svg#mic"></use></svg><div class="detail">Artists</div></a></li>
          <li><a href="/albums" data-navigo><svg class="feather"><use href="/img/feather-sprite.svg#disc"></use></svg><div class="detail">Albums</div></a></li>
          <li><a href="/genres" data-navigo><svg class="feather"><use href="/img/feather-sprite.svg#music"></use></svg><div class="detail">Genres</div></a></li>
          <li><a href="/settings" data-navigo><svg class="feather"><use href="/img/feather-sprite.svg#settings"></use></svg><div class="detail">Settings</div></a></li>
          <li><a href="/logout" data-navigo><svg class="feather"><use href="/img/feather-sprite.svg#log-out"></use></svg><div class="detail">Log Out</div></a></li>
        </ul>
      </aside>
      <div id="control-bar" class="is-active" data-bind="swipeup: showQueue">
        <div class="progress-topper" style="transition: all 1000ms linear" data-bind="style: { width: (playing.elapsed() / playing.duration() * 100) + '%' }"></div>
        <div class="row is-marginless">
          <div class="col-xs col-md">
            <div class="row now-playing">
              <div class="col-xs is-narrow">
                <figure class="image is-70x70">
                  <img data-bind="attr: { src: playing.art }">
                </figure>
              </div>
              <div class="col-xs">
                <p class="is-5" data-bind="text: playing.title"></p>
                <p class="subtitle is-5" data-bind="text: playing.artist"></p>
              </div>
            </div>
          </div>
          <div class="col-xs no-grow col-md playing-controls misc-controls">
            <svg class="random feather hidden--to-desktop"><use href="/img/feather-sprite.svg#shuffle"></use></svg>
            <svg class="feather prev" data-bind="click: playPrev"><use href="/img/feather-sprite.svg#skip-back"></use></svg>
            <span class="play-button pointer" data-bind="click: togglePlay">
              <svg class="feather" data-bind="css: { 'is-hidden': playing.state() == true }"><use href="/img/feather-sprite.svg#play"></use></svg>
              <svg class="feather" data-bind="css: { 'is-hidden': playing.state() != true }"><use href="/img/feather-sprite.svg#pause"></use></svg>
            </span>
            <svg class="feather next" data-bind="click: playNext"><use href="/img/feather-sprite.svg#skip-forward"></use></svg>
            <svg class="repeat feather hidden--to-desktop"><use href="/img/feather-sprite.svg#repeat"></use></svg>
          </div>
          <div class="col-md has-text-right hidden--to-desktop">
            <div class="row end-md">
              <div class="col-md no-grow play-progress">
                <span data-bind="text: Math.floor(playing.elapsed() / 60) + ':' + ('0' + (playing.elapsed() % 60)).slice(-2, 3)"></span>/<span data-bind="text: Math.floor(playing.duration() / 60) + ':' + ('0' + (playing.duration() % 60)).slice(-2, 3)"></span>
              </div>
              <div class="col-md no-grow">
                <svg class="queue feather hidden--to-desktop" data-bind="click: toggleQueue"><use href="/img/feather-sprite.svg#queue-alt"></use></svg>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="queue-list" data-bind="css: { 'is-active': queueVisible() === true }">
        <div id="queue-header" data-bind="swipedown: toggleQueue">
          <h1>Play Queue</h1>
        </div>
        <div id="queue-items">
          <table data-bind="foreach: queue.list">
            <tr data-bind="css: { 'is-playing': playing() == true }">
              <td data-bind="click: $parent.queue.changePos"><figure class="image is-40x40"><img data-bind="attr: { src: art }" loading="lazy"></figure></td>
              <td data-bind="click: $parent.queue.changePos"><p class="is-5" data-bind="text: title"></p><p class="subtitle is-5" data-bind="text: albumartist + ' - ' + (Math.floor(duration / 60) + ':' + ('0' + (duration % 60)).slice(-2, 3))"></p></td>
              <td data-bind="click: $parent.queue.remove"><span class="delete"><svg class="feather delete"><use xlink:href="/img/feather-sprite.svg#x-circle"></use></svg></span></td>
            </tr>
          </table>
        </div>
      </div>
      <div id="modal-container"></div>
      <div id="burger" class="hidden--for-desktop" data-bind="click: showMenu">
        <svg class="feather burger"><use href="/img/feather-sprite.svg#burger"></use></svg>
      </div>
      <!--
      <div id="search-input-container" class="hidden--to-desktop">
        <input id="search-input" type="text" placeholder="" value=""/>
      </div>
      -->
      <div id="disconnect-message">
        <div class="has-text-centered">
          <div class="animation-container">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
          </div>
          <p class="is-1">Connection to player lost</p>
          <p class="is-3">Reconnecting</p>
        </div>
      </div>
      <audio preload="auto" autoplay id="audio-player" data-bind="event: { ended: player.complete, timeupdate: player.update, play: player.play, pause: player.pause }"></audio>
    </template>

    <template id="t-login">
      <div class="container" style="height: 100vh">
        <div class="row" style="height: 100%; align-items: center;">
          <div class="col-xs-6 col-xs-offset-3 has-text-centered">
            <img src="/img/falk-blue-white.svg"/>
            <h1>Soundbyte</h1>
            <p class="subtitle is-4">Please login to access your music!</p>
            <br/>
            <fieldset style="margin: 5px 0; max-width: 300px; margin: 0 auto">
              <input data-bind="value: username, event: { 'keyup': enterCheck }" class="input" type="text" placeholder="Username" autofocus="true" />
            </fieldset>
            <br/>
            <fieldset style="margin: 5px 0; max-width: 300px; margin: 0 auto">
              <input data-bind="value: password, event: { 'keyup': enterCheck }" class="input" type="password" placeholder="Password" />
            </fieldset>
            <span class="message-danger" data-bind="text: loginError, css: { 'is-hidden': loginError() === '' }"></span>
            <br/>
            <button class="button is-rounded is-primary" data-bind="click: login">Log In</button>
          </div>
        </div>
      </div>
    </template>

    <template id="t-welcome">
      <div class="container" style="height: 100vh">
        <div class="row" style="height: 100%; align-items: center;">
          <div class="col-xs-6 col-xs-offset-3 has-text-centered">
            <img src="/img/falk-blue-white.svg"/>
            <h1>Welcome!</h1>
            <p class="subtitle is-3">It looks like you're new around here</p><p class="is-6 has-text-centered">Before you can log in you'll need to set the admin account password<br><br></p>
            <fieldset style="margin: 5px 0; max-width: 300px; margin: 0 auto">
              <input style="background-color: #404040; border-color: #404040" data-bind="value: username" class="input" type="text" readonly />
              <p class="small"></p>
            </fieldset>
            <fieldset style="margin: 5px 0; max-width: 300px; margin: 0 auto">
              <input data-bind="value: password" class="input" type="password" placeholder="Password" autofocus="true" />
              <p class="has-text-danger" data-bind="text: passwordMessage"></p>
            </fieldset>
            <fieldset style="margin: 5px 0; max-width: 300px; margin: 0 auto">
              <input data-bind="value: vpassword" class="input" type="password" placeholder="Verify password" />
              <p class="has-text-danger" data-bind="text: vpasswordMessage"></p>
            </fieldset>
            <fieldset style="margin: 5px 0">
              <button class="button is-rounded is-primary" data-bind="click: setPassword">Set Password</button>
            </fieldset>
          </div>
        </div>
      </div>
    </template>

    <template id="t-home">
      <div class="container-fluid max" data-bind="swipeup: showQueue">
        <!--
        <div class="background-container hidden--to-desktop">
          <figure class="image"><img src="/art/artist/background/blur/10cc.jpg"></figure>
        </div>
        -->
        <div class="row">
          <div class="col-xs-10 col-md-3 has-margin-auto art">
            <figure id="home-albumart" class="image is-1by1"><img loading="lazy" data-bind="attr: { src: playing.art }"></figure>
            <div id="mobile-toolbar" class="has-text-centered" data-bind="if: playing.album() !== ''">
              <div>
                <svg class="feather"><use xlink:href="/img/feather-sprite.svg#heart"></use></svg>
              </div>
              <div>
                <svg class="feather"><use xlink:href="/img/feather-sprite.svg#plus"></use></svg>
              </div>
            </div>
          </div>
          <div class="col-xs-10 col-xs-offset-1">
            <h1 id="home-title" class="has-text-centered has-no-overflow" data-bind="text: playing.title"></h1>
            <p class="has-text-centered subtitle is-3 has-no-overflow hidden--to-desktop">
              <a id="home-album" href="" data-navigo data-bind="attr: { href: '/album/' + encodeURIComponent(playing.artist()) + '/' + encodeURIComponent(playing.album()) }, text: playing.album"></a>
            </p>
            <p class="has-text-centered subtitle is-3 has-no-overflow">
              <a id="home-artist" data-navigo data-bind="attr: { href: '/artist/' + playing.artist() }, text: playing.artist"></a>
            </p>
            <p class="has-text-centered" data-bind="if: playing.quality() !== ''">
              <span id="home-quality" class="tag is-small" data-bind="text: playing.quality"></span>
            </p>
          </div>
          <div id="mobile-controls" class="col-xs-12 mobile-controls hidden--for-desktop">
            <span><svg class="feather random is-small"><use xlink:href="/img/feather-sprite.svg#shuffle"></use></svg></span>
            <span><svg class="feather"><use xlink:href="/img/feather-sprite.svg#skip-back"></use></svg></span>
            <button class="button is-primary is-rounded has-no-margin"><svg class="feather"><use xlink:href="/img/feather-sprite.svg#pause"></use></svg></button>
            <span><svg class="feather"><use xlink:href="/img/feather-sprite.svg#skip-forward"></use></svg></span>
            <span><svg class="feather repeat is-small"><use xlink:href="/img/feather-sprite.svg#repeat"></use></svg></span>
          </div>
          <div class="col-xs-10 col-xs-offset-1 hidden--for-desktop">
            <div id="mobile-progress-bar">
              <div style="width: 0px;"></div>
            </div>
          </div>
        </div>
        <div class="hidden--for-desktop" id="swipe-up-queue" data-bind="tap: showQueue"><svg class="feather"><use xlink:href="/img/feather-sprite.svg#chevron-up"></use></svg></div>
      </div>
    </template>

    <template id="t-tiles">
      <div class="container-fluid">
        <h1 class="is-capitalized" data-bind="text: pageTitle"></h1>
        <div class="row art-container" data-bind="foreach: tiles">
          <div class="col-lg-2 col-xs-4 art has-text-centered item-tile" data-bind="template: { name: ((surl !== '') ? 't-tile-subtitle-link' : 't-tile-subtitle' ) }"></div>
        </div>
      </div>
    </template>
    <template id="t-tile-subtitle-link">
      <a data-bind="attr: { href: url }, template: { afterRender: $parent.updateLinks }" data-navigo> <!--  -->
        <figure class="image is-1by1"><img data-bind="attr: { src: art }" loading="lazy"></figure>
        <p class="is-5 is-capitalized" data-bind="text: title"></p>
      </a>
      <a data-bind="attr: { href: surl }" data-navigo>
        <p class="subtitle is-5 is-capitalized" data-bind="text: subtitle"></p>
      </a>
    </template>
    <template id="t-tile-subtitle">
      <a data-bind="attr: { href: url }, template: { afterRender: $parent.updateLinks }" data-navigo> <!--  -->
        <figure class="image is-1by1"><img data-bind="attr: { src: art }" loading="lazy"></figure>
        <p class="is-5 is-capitalized" data-bind="text: title"></p>
      </a>
      <p class="subtitle is-5 is-capitalized" data-bind="text: subtitle"></p>
    </template>

    <template id="t-album">
        <div class="container-fluid" data-bind="with: album">
          <div class="row">
            <div class="col-xs-12 col-md-5 has-text-centered-desktop">
              <div class="row album-detail">
                <div class="col-md-8 col-md-offset-2 col-xs-4 art">
                  <figure class="image"><img data-bind="attr: { src: art }" loading="lazy"></figure>
                </div>
                <div class="col-md-8 col-md-offset-2 col-xs-8">
                  <h1 class="album-title" data-bind="text: title"></h1>
                  <p class="subtitle is-1"><a data-navigo data-bind="attr: { href: '/artist/' + encodeURIComponent(artist) }, text: artist"></a></p>
                  <p class="is-4 detail" data-bind="text: year"></p>
                  <p class="is-4"><a data-navigo="" data-bind="attr: { href: '/genre/' + encodeURIComponent(genre) }, text: genre"></a></p>
                  <p class="is-6 tag is-rounded detail" data-bind="text: shortformat"></p>
                </div>
              </div>
            </div>
            <div class="col-xs-12 col-md-7" data-bind="template: { afterRender: $parent.updateLinks }">
              <div class="col-xs-12 col-md-11">
                <div class="row album-detail">
                  <h1 class="hidden--to-tablet">Album Tracks</h1>
                  <table class="table songs">
                    <tbody data-bind="foreach: tracks">
                        <tr data-bind="attr: { 'data-id': _id }">
                          <td class="pointer" data-bind="click: $parents[1].playAlbumSong"><p class="is-5" data-bind="text: track + '. ' + title"></p><p class="subtitle is-5" data-bind="text: albumartist + ' - ' + Math.floor(duration / 60) + ':' + ('0' + (duration % 60)).slice(-2, 3)"></p></td>
                          <td class="hidden--to-tablet"><span class="tag" data-bind="text: shortformat"></span></td>
                          <td class="is-narrow">
                            <div class="dropdown is-right">
                              <span onclick="this.closest('div').classList.toggle('is-active')"><svg class="feather"><use xlink:href="/img/feather-sprite.svg#more-vertical"></use></svg></span>
                              <div class="dropdown-content">
                                <span class="dropdown-item">Play</span>
                                <span class="dropdown-item">Add to queue</span>
                                <span class="dropdown-item">Clear and play</span>
                                <span class="dropdown-item">Add to playlist</span>
                              </div>
                            </div>
                          </td>
                        </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
    </template>

    <template id="t-settings">
      <div class="container-fluid">
        <h1>Settings</h1>
        <p class="is-1">Music Library</p>
        <div class="box row has-text-centered">
          <div class="col-xs-4"><h1 data-bind="text: stats.songs"></h1><p class="subtitle is-3">Songs</p></div>
          <div class="col-xs-4"><h1 data-bind="text: stats.artists"></h1><p class="subtitle is-3">Artists</p></div>
          <div class="col-xs-4"><h1 data-bind="text: stats.albums"></h1><p class="subtitle is-3">Albums</p></div>
        </div>
        <table class="table">
          <thead>
            <tr><th>Library Locations</th><th></th></tr>
          </thead>
          <tbody data-bind="foreach: { data: settings.locations.list, as: 'item' }">
            <tr>
              <td><p class="is-6" data-bind="text: item"></p></td>
              <td class="is-narrow pointer" data-bind="click: $parent.settings.locations.remove"><span class="delete"><svg class="feather delete"><use xlink:href="/img/feather-sprite.svg#x-circle"></use></svg></span></td>
            </tr>
          </tbody>
        </table>
        <div style="display: flex; align-items: center;">
          <button class="button no-v is-rounded is-primary" onclick="document.getElementById('dir-modal').classList.add('is-active')">Add directory</button>
          <button class="button no-v is-primary is-rounded" data-bind="click: settings.database.update">Update Library</button>
          <button class="button no-v is-primary is-rounded" data-bind="click: settings.database.rescan">Rescan Library</button>
        </div>
        <div data-bind="if: settings.isAdmin">
          <br/>
          <p class="is-1">Users</p>
          <table class="table">
            <thead><th colspan="2">Registered users</th></thead>
            <tbody data-bind="foreach: settings.users.list">
              <tr>
                <td><p data-bind="text: user"></p></td>
                <td class="is-narrow pointer" data-bind="if: user !== 'admin'"><span class="delete" data-bind="click: $parent.settings.users.remove"><svg class="feather delete"><use xlink:href="/img/feather-sprite.svg#x-circle"></use></svg></span></td>
              </tr>
            </tbody>
          </table>
          <button class="button no-v is-rounded is-primary" data-bind="click: settings.users.add.setVisible">Add user</button>
        </div>

        <div id="dir-modal" class="modal is-small modal-fx-fadeInScale">
          <div class="modal-content">
            <div class="box">
              <h1>Add directory</h1>
              <div>
                <input class="input" type="text" readonly value="" data-bind="value: settings.directories.location" />
                <p></p>
              </div>
              <div style="padding: 2px 0; max-height: 70vh; overflow-y: auto">
                <table data-bind="foreach: settings.directories.list">
                  <tr class="pointer" data-bind="click: $parent.settings.directories.load"><td class="is-narrow"><svg class="feather"><use href="/img/feather-sprite.svg#folder"></use></svg>&nbsp</td><td data-bind="text: name"></td></tr>
                </table>
              </div>
              <p></p>
              <button class="button is-rounded" onclick="this.closest('.modal').classList.remove('is-active')">Cancel</button>
              <button class="button is-primary is-rounded" onclick="this.closest('.modal').classList.remove('is-active')" data-bind="click: settings.locations.add">Add directory</button>
            </div>
          </div>
        </div>
        <div id="user-modal" class="modal is-small modal-fx-fadeInScale" data-bind="css: { 'is-active': settings.users.add.visible() === true }">
          <div class="modal-content">
            <div class="box">
              <h1>Add user</h1>
              <fieldset>
                <input class="input" type="text" value="" placeholder="Username" data-bind="value: settings.users.add.name" autofocus="true"/>
              <fieldset>
                <input class="input" type="password" value="" placeholder="Password" data-bind="value: settings.users.add.password" />
              </fieldset>
              <fieldset>
                <input class="input" type="password" value="" placeholder="Verify password" data-bind="value: settings.users.add.vpassword" />
              </fieldset>
              <fieldset style="display: flex; align-items: center;">
                <label class="switch"><input type="checkbox" data-bind="checked: settings.users.add.inherit"><span class="slider round"></span></label><span style="margin-left: 5px">Inherit my library</span>
              </fieldset>
              <fieldset style="display: flex; align-items: center;">
                <label class="switch"><input type="checkbox" data-bind="checked: settings.users.add.admin"><span class="slider round"></span></label><span style="margin-left: 5px">Admin</span>
              </fieldset>
              <p class="has-text-danger" data-bind="text: settings.users.add.error"></p>
              <br/>
              <fieldset>
                <button class="button is-rounded" data-bind="click: settings.users.add.unsetVisible">Cancel</button>
                <button class="button is-primary is-rounded" data-bind="click: settings.users.add.process">Add user</button>
              </fieldset>
            </div>
          </div>
        </div>
      </div>
    </template>
  </body>
  <script src="main.js"></script>
</html>